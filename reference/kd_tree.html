<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="An efficient spatial search is often done in two steps: 1) Prepare the points
to search in a potential costly operation, 2) Perform one or more searches on
the prepared data. The orion package supports efficient searching based on a
kd tree representation of the search space. The kd tree can be created with a
range of different setups, using different splitters and bucket sizes for
leaf nodes."><title>Create a kd tree of points to search on — kd_tree • orion</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Gelasio-0.4.4/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.4/font.css" rel="stylesheet"><link href="../deps/Montserrat-0.4.4/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a kd tree of points to search on — kd_tree"><meta property="og:description" content="An efficient spatial search is often done in two steps: 1) Prepare the points
to search in a potential costly operation, 2) Perform one or more searches on
the prepared data. The orion package supports efficient searching based on a
kd tree representation of the search space. The kd tree can be created with a
range of different setups, using different splitters and bucket sizes for
leaf nodes."><meta property="og:image" content="https://orion.r-euclid.com/reference/figures/card.png"><meta property="og:image:alt" content="orion: Spatial Searching for euclid"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@thomasp85"><meta name="twitter:site" content="@rstudio"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">orion</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-euclid-ecosystem">Euclid ecosystem</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-euclid-ecosystem">
    <h6 class="dropdown-header" data-toc-skip>Foundation</h6>
    <a class="external-link dropdown-item" href="https://r-euclid.com">Euclid</a>
    <a class="external-link dropdown-item" href="https://polyclid.r-euclid.com">Polyclid</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Utilities</h6>
    <a class="dropdown-item" href="https://orion.r-euclid.com">Orion</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/thomasp85/polyclid/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Create a kd tree of points to search on</h1>
      <small class="dont-index">Source: <a href="https://github.com/thomasp85/orion/blob/HEAD/R/tree.R" class="external-link"><code>R/tree.R</code></a></small>
      <div class="d-none name"><code>kd_tree.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>An efficient spatial search is often done in two steps: 1) Prepare the points
to search in a potential costly operation, 2) Perform one or more searches on
the prepared data. The orion package supports efficient searching based on a
kd tree representation of the search space. The kd tree can be created with a
range of different setups, using different splitters and bucket sizes for
leaf nodes.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">kd_tree</span><span class="op">(</span></span>
<span>  <span class="va">points</span>,</span>
<span>  split_strategy <span class="op">=</span> <span class="st">"sliding_midpoint"</span>,</span>
<span>  bucket_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  aspect <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">is_kd_tree</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>points</dt>
<dd><p>A <code>euclid_point</code> vector holding the points to search</p></dd>


<dt>split_strategy</dt>
<dd><p>One of <code>"fair"</code>, <code>"sliding_fair"</code>, <code>"sliding_midpoint"</code>,
<code>"median_of_max_spread"</code>, <code>"median_of_rectangle"</code>, <code>"midpoint_of_max_spread"</code>,
or <code>"midpoint_of_rectangle"</code>, defining the splitting strategy to use when
creating new nodes in the kd tree</p></dd>


<dt>bucket_size</dt>
<dd><p>The maximum number of points in the terminal nodes of the
kd tree</p></dd>


<dt>aspect</dt>
<dd><p>For <code>"fair"</code> and <code>"sliding_fair</code> splitting strategies, defines
the maximum aspect ratio between the largest and smallest side of the split.</p></dd>


<dt>x</dt>
<dd><p>An <code>orion_kd_tree</code> object</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An <code>orion_kd_tree</code> object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Search performance is mostly informed by how well balanced the tree is. You
can influence this by selecting a splitting rule to use when building up the
tree. There is no single best rule and all rules has degenerate worst cases.
If you have trouble during tree construction or performance issues during
searches, try a different splitting rule or bucket size.</p><ul><li><p><code>"midpoint_of_rectangle"</code>: This splitting rule cuts a rectangle through its
midpoint orthogonal to the longest side.</p></li>
<li><p><code>"midpoint_of_max_spread"</code>: This splitting rule cuts a rectangle through
<code>(Mind+Maxd)/2</code> orthogonal to the dimension with the maximum point spread
<code>[Mind,Maxd]</code>.</p></li>
<li><p><code>"sliding_midpoint"</code> (default): This is a modification of the midpoint of
rectangle splitting rule. It first attempts to perform a midpoint of
rectangle split as described above. If data points lie on both sides of the
separating plane the sliding midpoint rule computes the same separator as
the midpoint of rectangle rule. If the data points lie only on one side it
avoids this by sliding the separator, computed by the midpoint of rectangle
rule, to the nearest data point.</p></li>
<li><p><code>"median_of_rectangle</code>: The splitting dimension is the dimension of the
longest side of the rectangle. The splitting value is defined by the median
of the coordinates of the data points along this dimension.</p></li>
<li><p><code>"median_of_max_spread"</code>: The splitting dimension is the dimension with the
largest spread. The splitting value is defined by the median of the
coordinates of the data points along this dimension.</p></li>
<li><p><code>"fair"</code>: This splitting rule is a compromise between the median of
rectangle splitting rule and the midpoint of rectangle splitting rule. This
splitting rule maintains an upper bound on the maximal allowed ratio of the
longest and shortest side of a rectangle (the value of this upper bound is
set in the constructor of the fair splitting rule). Among the splits that
satisfy this bound, it selects the one in which the points have the largest
spread. It then splits the points in the most even manner possible, subject
to maintaining the bound on the ratio of the resulting rectangles.</p></li>
<li><p><code>"sliding_fair"</code>: This splitting rule is a compromise between the fair
splitting rule and the sliding midpoint rule. Sliding fair-split is based
on the theory that there are two types of splits that are good: balanced
splits that produce fat rectangles, and unbalanced splits provided the
rectangle with fewer points is fat. Also, this splitting rule maintains an
upper bound on the maximal allowed ratio of the longest and shortest side
of a rectangle (the value of this upper bound is set in the constructor of
the fair splitting rule). Among the splits that satisfy this bound, it
selects the one one in which the points have the largest spread. It then
considers the most extreme cuts that would be allowed by the aspect ratio
bound. This is done by dividing the longest side of the rectangle by the
aspect ratio bound. If the median cut lies between these extreme cuts, then
we use the median cut. If not, then consider the extreme cut that is closer
to the median. If all the points lie to one side of this cut, then we slide
the cut until it hits the first point. This may violate the aspect ratio
bound, but will never generate empty cells.</p></li>
</ul><p>In order to improve performance of range queries on large data sets you can
experiment with increasing the bucket size during tree building as it can
lead to fewer traversels during searching.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

